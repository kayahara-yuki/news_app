# ä½ç½®æƒ…å ±ãƒ™ãƒ¼ã‚¹ãƒ‹ãƒ¥ãƒ¼ã‚¹å…±æœ‰ SNS ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  - è¨­è¨ˆæ›¸

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](#ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ)
2. [UI/UX è¨­è¨ˆ](#uiuxè¨­è¨ˆ)
3. [æŠ€è¡“è¨­è¨ˆ](#æŠ€è¡“è¨­è¨ˆ)
4. [åœ°å›³ãƒ»ä½ç½®æƒ…å ±è¨­è¨ˆ](#åœ°å›³ä½ç½®æƒ…å ±è¨­è¨ˆ)
5. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ)
6. [ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ)

---

## ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ï¼ˆiOS + Supabaseï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     iOS ã‚¢ãƒ—ãƒªå±¤                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚               SwiftUI App                                   â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚â”‚
â”‚  â”‚  â”‚  Map View   â”‚  â”‚ Post Feed   â”‚  â”‚ Profile     â”‚        â”‚â”‚
â”‚  â”‚  â”‚  (MapKit)   â”‚  â”‚   View      â”‚  â”‚   View      â”‚        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Supabase SDK      â”‚
                    â”‚   (Swift Client)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Supabase Backend                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ PostgreSQL  â”‚  â”‚ Auth        â”‚  â”‚ Realtime    â”‚              â”‚
â”‚  â”‚ + PostGIS   â”‚  â”‚ (JWT)       â”‚  â”‚ (WebSocket) â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Storage     â”‚  â”‚ Edge        â”‚  â”‚ API         â”‚              â”‚
â”‚  â”‚ (Files)     â”‚  â”‚ Functions   â”‚  â”‚ (PostgREST) â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### iOS + Supabase ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆ

#### 1. iOS ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: SwiftUI (iOS 18+)
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: MVVM + Clean Architecture
- **è²¬å‹™**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã€çŠ¶æ…‹ç®¡ç†
- **ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
  - MapView (MapKit çµ±åˆ)
  - PostFeedView (æŠ•ç¨¿ä¸€è¦§)
  - ProfileView (ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«)
  - EmergencyView (ç½å®³æ™‚ãƒ¢ãƒ¼ãƒ‰)

#### 2. Supabase ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµ±åˆ

- **èªè¨¼**: Supabase Auth (JWT + OAuth)
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL + PostGIS
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **: Supabase Realtime (WebSocket)
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Supabase Storage
- **API**: è‡ªå‹•ç”Ÿæˆ RESTful API (PostgREST)
- **ã‚¨ãƒƒã‚¸é–¢æ•°**: Deno ã«ã‚ˆã‚‹ serverless functions

#### 3. ä½ç½®æƒ…å ±ãƒ»åœ°å›³æ©Ÿèƒ½

- **åœ°å›³ã‚¨ãƒ³ã‚¸ãƒ³**: MapKit (iOS 18 æœ€æ–°æ©Ÿèƒ½)
- **ä½ç½®æƒ…å ±**: CoreLocation + LocationManager
- **ç©ºé–“ãƒ‡ãƒ¼ã‚¿å‡¦ç†**: PostGIS + Supabase Edge Functions
- **ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: Apple Maps + ç‹¬è‡ªå®Ÿè£…

#### 4. ãƒ¡ãƒ‡ã‚£ã‚¢å‡¦ç†

- **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: Supabase Storage
- **ç”»åƒå‡¦ç†**: iOS Image I/O + Core Image
- **å‹•ç”»å‡¦ç†**: AVFoundation
- **æœ€é©åŒ–**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰åœ§ç¸® + ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰æœ€é©åŒ–

#### 5. é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

- **ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥**: Apple Push Notification Service (APNs)
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: Supabase Realtime
- **ç·Šæ€¥é€šçŸ¥**: é«˜å„ªå…ˆåº¦ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
- **ä½ç½®ãƒ™ãƒ¼ã‚¹é€šçŸ¥**: CoreLocation + åœ°åŸŸç›£è¦–

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

#### 1. æŠ•ç¨¿ä½œæˆãƒ•ãƒ­ãƒ¼ (iOS + Supabase)

```
1. SwiftUI App â†’ Supabase SDK (æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿æº–å‚™)
2. Supabase SDK â†’ Supabase Storage (ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)
3. Supabase SDK â†’ PostgreSQL (æŠ•ç¨¿ä¿å­˜ + PostGISä½ç½®ãƒ‡ãƒ¼ã‚¿)
4. PostgreSQL Trigger â†’ Supabase Realtime (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡)
5. Supabase Edge Function â†’ APNs (ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã¸ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥)
```

#### 2. åœ°å›³ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒ­ãƒ¼ (MapKit + Supabase)

```
1. MapView â†’ CoreLocation (ç¾åœ¨ä½ç½®å–å¾—)
2. SwiftUI App â†’ Supabase SDK (ä½ç½®ãƒ™ãƒ¼ã‚¹æŠ•ç¨¿ã‚¯ã‚¨ãƒª)
3. Supabase â†’ PostGIS (ç©ºé–“æ¤œç´¢å‡¦ç†)
4. MapKit â†’ Apple Maps (åœ°å›³ã‚¿ã‚¤ãƒ«è¡¨ç¤º)
5. SwiftUI â†’ MapKit (æŠ•ç¨¿ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º)
```

#### 3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ãƒ•ãƒ­ãƒ¼ (iOS Native)

```
1. ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ â†’ Supabase Database
2. Supabase Realtime â†’ iOS WebSocketæ¥ç¶š
3. Supabase Edge Function â†’ APNs
4. APNs â†’ iOS ãƒ‡ãƒã‚¤ã‚¹ (ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥)
5. iOS App â†’ UIæ›´æ–° (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ )
```

---

## UI/UX è¨­è¨ˆ

### åœ°å›³ãƒ™ãƒ¼ã‚¹ãƒ¡ã‚¤ãƒ³ UI è¨­è¨ˆ

#### 1. iOS ã‚¢ãƒ—ãƒªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Navigation Bar: ã‚¿ã‚¤ãƒˆãƒ« | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« | é€šçŸ¥ã‚¢ã‚¤ã‚³ãƒ³        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚                     MapKitåœ°å›³                              â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  ğŸ“ æŠ•ç¨¿ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³                                        â”‚ â”‚
â”‚  â”‚  ğŸ”´ ç·Šæ€¥æƒ…å ±ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³                                     â”‚ â”‚
â”‚  â”‚  ğŸ¢ é¿é›£æ‰€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³                                       â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  [ç¾åœ¨ä½ç½®ãƒœã‚¿ãƒ³]                                             â”‚ â”‚
â”‚  â”‚  [ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³]                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  æŠ•ç¨¿è©³ç´°Sheet (è¡¨ç¤ºæ™‚)                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Liquid Glass Effect                                        â”‚ â”‚
â”‚  â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± | æŠ•ç¨¿å†…å®¹ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tab Bar: åœ°å›³ | ãƒ•ã‚£ãƒ¼ãƒ‰ | æŠ•ç¨¿ | ç·Šæ€¥ | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. MapKit ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆiOSï¼‰

- **ã‚ºãƒ¼ãƒ æ“ä½œ**: ãƒ”ãƒ³ãƒã‚¸ã‚§ã‚¹ãƒãƒ£
- **ãƒ‘ãƒ³æ“ä½œ**: ãƒ‰ãƒ©ãƒƒã‚°ã‚¸ã‚§ã‚¹ãƒãƒ£
- **ãƒãƒ¼ã‚«ãƒ¼ã‚¿ãƒƒãƒ—**: æŠ•ç¨¿è©³ç´°ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆLiquid Glass ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼‰
- **é•·æŠ¼ã—**: æ–°è¦æŠ•ç¨¿ä½œæˆï¼ˆä½ç½®æƒ…å ±è‡ªå‹•å–å¾—ï¼‰
- **3D Touch**: æŠ•ç¨¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º

#### 3. ãƒãƒ¼ã‚«ãƒ¼è¨­è¨ˆ

- **é€šå¸¸æŠ•ç¨¿**: é’è‰²å††å½¢ãƒãƒ¼ã‚«ãƒ¼
- **ãƒ‹ãƒ¥ãƒ¼ã‚¹æŠ•ç¨¿**: ã‚ªãƒ¬ãƒ³ã‚¸è‰²æ–°èã‚¢ã‚¤ã‚³ãƒ³
- **ç·Šæ€¥æƒ…å ±**: èµ¤è‰²è­¦å‘Šã‚¢ã‚¤ã‚³ãƒ³
- **é¿é›£æ‰€**: ç·‘è‰²å®¶ã‚¢ã‚¤ã‚³ãƒ³
- **æ”¯æ´æ‹ ç‚¹**: ç´«è‰²ãƒãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆï¼ˆSwiftUIï¼‰

#### 1. æŠ•ç¨¿ä½œæˆç”»é¢ï¼ˆSheet Presentation + Liquid Glassï¼‰

```swift
struct PostCreationView: View {
    @State private var content: String = ""
    @State private var url: String = ""
    @State private var selectedLocation: CLLocation?

    var body: some View {
        NavigationStack {
            VStack(spacing: 16) {
                // ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
                TextEditor(text: $content)
                    .frame(minHeight: 100)
                    .padding()
                    .background(.regularMaterial, in: RoundedRectangle(cornerRadius: 12))

                // URLå…¥åŠ›
                HStack {
                    Image(systemName: "link")
                    TextField("ãƒ‹ãƒ¥ãƒ¼ã‚¹URLã‚’è²¼ã‚Šä»˜ã‘", text: $url)
                }
                .padding()
                .background(.thickMaterial, in: RoundedRectangle(cornerRadius: 12))

                // ä½ç½®æƒ…å ±è¨­å®š
                LocationSelector(selectedLocation: $selectedLocation)
            }
            .padding()
            .navigationTitle("æ–°è¦æŠ•ç¨¿")
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .navigationBarLeading) {
                    Button("ã‚­ãƒ£ãƒ³ã‚»ãƒ«") { }
                }
                ToolbarItem(placement: .navigationBarTrailing) {
                    Button("æŠ•ç¨¿") { }
                        .buttonStyle(.borderedProminent)
                }
            }
        }
        .presentationDetents([.medium, .large])
        .presentationBackground(.regularMaterial)
    }
}
```

â”‚ ğŸ“ ãƒ¡ãƒ‡ã‚£ã‚¢: [ğŸ“·] [ğŸ¥] [ğŸ“] â”‚
â”‚ ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒª: [â–¼ é¸æŠ] â”‚
â”‚ ğŸ”’ å…¬é–‹ç¯„å›²: [â–¼ å…¨ä½“å…¬é–‹] â”‚
â”‚ â”‚
â”‚ [ã‚­ãƒ£ãƒ³ã‚»ãƒ«] [ä¸‹æ›¸ãä¿å­˜] [æŠ•ç¨¿] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

#### 2. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [@username] [ãƒ•ã‚©ãƒ­ãƒ¼] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ] åå‰: ç”°ä¸­å¤ªéƒ â”‚
â”‚ å ´æ‰€: æ±äº¬éƒ½ â”‚
â”‚ æŠ•ç¨¿: 123 â”‚
â”‚ ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼: 456 â”‚
â”‚ ãƒ•ã‚©ãƒ­ãƒ¼ä¸­: 78 â”‚
â”‚ â”‚
â”‚ è‡ªå·±ç´¹ä»‹: åœ°åŸŸã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ãŠå±Šã‘ã—ã¾ã™ â”‚
â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æŠ•ç¨¿ä¸€è¦§ â”‚ â”‚
â”‚ â”‚ [æŠ•ç¨¿ 1] [æŠ•ç¨¿ 2] [æŠ•ç¨¿ 3] ... â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

#### 3. ç½å®³æ™‚ç·Šæ€¥ç”»é¢

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸš¨ ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰ - ç½å®³æƒ…å ± â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸ æœ€æ–°ç·Šæ€¥æƒ…å ± â”‚
â”‚ â”œ åœ°éœ‡æƒ…å ±: M7.0 éœ‡åº¦ 6 å¼· æ±äº¬éƒ½... â”‚
â”‚ â”œ æ´¥æ³¢è­¦å ±: åƒè‘‰çœŒæ²¿å²¸... â”‚
â”‚ â”” é¿é›£æŒ‡ç¤º: ã€‡ã€‡åŒºå…¨åŸŸ... â”‚
â”‚ â”‚
â”‚ ğŸ¥ é¿é›£æ‰€æƒ…å ± â”‚
â”‚ â”œ ã€‡ã€‡å°å­¦æ ¡ (ç©ºãã‚ã‚Š) â”‚
â”‚ â”œ â–³â–³ ä½“è‚²é¤¨ (æº€å“¡) â”‚
â”‚ â”” Ã—Ã— å…¬æ°‘é¤¨ (ä¸æ˜) â”‚
â”‚ â”‚
â”‚ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®‰å¦ç¢ºèª â”‚
â”‚ [å®¶æ—ã®å®‰å¦ã‚’ç¢ºèª] [è‡ªåˆ†ã®å®‰å¦ã‚’å ±å‘Š] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

````

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹è¨­è¨ˆ

#### 1. æƒ…å ±ç™ºè¦‹ä½“é¨“

- **ç›´æ„Ÿçš„ãªåœ°å›³æ“ä½œ**: ãƒ‘ãƒ³ãƒ»ã‚ºãƒ¼ãƒ ã§èˆˆå‘³ã®ã‚ã‚‹åœ°åŸŸã‚’æ¢ç´¢
- **ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: ã‚«ãƒ†ã‚´ãƒªãƒ»æ™‚é–“ãƒ»ä¿¡é ¼åº¦ã§ã®çµã‚Šè¾¼ã¿
- **é–¢é€£æƒ…å ±ã®ææ¡ˆ**: é–²è¦§ä¸­ã®æŠ•ç¨¿ã«é–¢é€£ã™ã‚‹è¿‘éš£æƒ…å ±ã‚’è‡ªå‹•ææ¡ˆ

#### 2. æŠ•ç¨¿ä½œæˆä½“é¨“

- **ä½ç½®æƒ…å ±ã®è‡ªå‹•å–å¾—**: GPS ã«ã‚ˆã‚‹ç¾åœ¨åœ°è‡ªå‹•è¨­å®š
- **ãƒªãƒ³ã‚¯è§£æ**: URL è²¼ã‚Šä»˜ã‘æ™‚ã®è‡ªå‹•ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä½ç½®æ¨å®š
- **ãƒ¡ãƒ‡ã‚£ã‚¢æœ€é©åŒ–**: ç”»åƒãƒ»å‹•ç”»ã®è‡ªå‹•åœ§ç¸®ãƒ»ãƒªã‚µã‚¤ã‚º

#### 3. ç¤¾ä¼šçš„ç›¸äº’ä½œç”¨ä½“é¨“

- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åå¿œ**: ã„ã„ã­ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã®å³åº§åæ˜ 
- **é©åˆ‡ãªé€šçŸ¥**: é‡è¦åº¦ã«å¿œã˜ãŸé€šçŸ¥ãƒ¬ãƒ™ãƒ«ã®èª¿æ•´
- **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å½¢æˆ**: åœ°åŸŸãƒ™ãƒ¼ã‚¹ã®ã¤ãªãŒã‚Šä¿ƒé€²

### ç”»é¢ã‚µã‚¤ã‚ºå¯¾å¿œè¨­è¨ˆ (iOS)

#### 1. iPhone Pro Max (430pxå¹…)

- ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åœ°å›³è¡¨ç¤º
- å¤§ããªã‚¿ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
- è©³ç´°ãªæŠ•ç¨¿æƒ…å ±è¡¨ç¤º

#### 2. iPhoneæ¨™æº– (393pxå¹…)

- æœ€é©åŒ–ã•ã‚ŒãŸåœ°å›³è¡¨ç¤º
- æ¨™æº–çš„ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸæƒ…å ±å¯†åº¦

#### 3. iPhone mini (375pxå¹…)

- ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªUIè¦ç´ 
- é‡è¦æƒ…å ±ã®å„ªå…ˆè¡¨ç¤º
- åŠ¹ç‡çš„ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

#### 4. iPadå¯¾å¿œ

- Split View / Slide Overå¯¾å¿œ
- ã‚ˆã‚Šè©³ç´°ãªæƒ…å ±è¡¨ç¤º
- ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯æœ€é©åŒ–

---

## æŠ€è¡“è¨­è¨ˆ

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆiOS SwiftUIï¼‰

#### 1. åŸºç›¤æŠ€è¡“

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: SwiftUI (iOS 18+)
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: MVVM + Clean Architecture
- **çŠ¶æ…‹ç®¡ç†**: ObservableObject + @Published
- **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: NavigationStack + NavigationPath
- **UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: æœ€æ–° SwiftUI + Liquid Glass ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

#### 2. åœ°å›³é–¢é€£ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

- **åœ°å›³ã‚¨ãƒ³ã‚¸ãƒ³**: MapKit (iOS 18ã®æœ€æ–°æ©Ÿèƒ½æ´»ç”¨)
- **ä½ç½®æƒ…å ±**: CoreLocation + LocationManager
- **åœ°ç†ç©ºé–“å‡¦ç†**: ç‹¬è‡ªå®Ÿè£… + PostGIS ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é€£æº
- **ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°**: MapKit ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ»é€šä¿¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

- **HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**: URLSession + async/await
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡**: Supabase Realtime
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabase (PostgreSQL + PostGIS)
- **èªè¨¼**: Supabase Auth
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Supabase Storage

#### 4. é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«

- **ä¾å­˜æ€§æ³¨å…¥**: Resolver / DIContainer
- **ãƒ†ã‚¹ãƒˆ**: XCTest + ViewInspector
- **UI ãƒ†ã‚¹ãƒˆ**: XCUITest
- **ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: SwiftFormat + SwiftLint

#### 5. æœ€æ–°æ©Ÿèƒ½æ´»ç”¨

- **Liquid Glass**: iOS 18ã®æ–°ã—ã„è¦–è¦šã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
- **Context7**: æœ€æ–°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªå‹•å–å¾—ã«ã‚ˆã‚‹é–‹ç™ºåŠ¹ç‡åŒ–
- **Swift 6**: Concurrency æœ€é©åŒ–

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆSupabaseï¼‰

#### 1. Supabase åŸºç›¤ã‚µãƒ¼ãƒ“ã‚¹

- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL 15.x + PostGIS
- **èªè¨¼**: Supabase Authï¼ˆJWT ãƒ™ãƒ¼ã‚¹ï¼‰
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **: Supabase Realtimeï¼ˆWebSocketï¼‰
- **API**: è‡ªå‹•ç”Ÿæˆ RESTful API + PostgREST
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Supabase Storage
- **é–¢æ•°**: Supabase Edge Functionsï¼ˆDenoï¼‰

#### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆï¼ˆSupabase PostgreSQLï¼‰

- **ç©ºé–“ãƒ‡ãƒ¼ã‚¿**: PostGIS æ‹¡å¼µã«ã‚ˆã‚‹åœ°ç†ãƒ‡ãƒ¼ã‚¿å‡¦ç†
- **RLS**: Row Level Security ã«ã‚ˆã‚‹ç´°ã‹ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **: WebSocket ã«ã‚ˆã‚‹å³åº§ãƒ‡ãƒ¼ã‚¿åŒæœŸ
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— + ãƒã‚¤ãƒ³ãƒˆã‚¤ãƒ³ã‚¿ã‚¤ãƒ å¾©å…ƒ

#### 3. Edge Functionsï¼ˆDenoï¼‰

```typescript
// ä½ç½®ãƒ™ãƒ¼ã‚¹æŠ•ç¨¿å–å¾—
export async function handler(req: Request) {
  const { lat, lng, radius } = await req.json()

  const { data, error } = await supabase
    .from('posts')
    .select('*')
    .within('location', lat, lng, radius)
    .order('created_at', { ascending: false })

  return new Response(JSON.stringify(data), {
    headers: { 'Content-Type': 'application/json' }
  })
}
````

#### 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»èªè¨¼

- **RLS ãƒãƒªã‚·ãƒ¼**: ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ¬ãƒ™ãƒ«ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶å¾¡
- **JWT èªè¨¼**: Supabase Auth ã«ã‚ˆã‚‹è‡ªå‹• JWT ç®¡ç†
- **OAuth**: Apple Sign-in, Google, GitHub ç­‰
- **åŒ¿åèªè¨¼**: ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ

### API è¨­è¨ˆï¼ˆSupabase + Edge Functionsï¼‰

#### 1. Supabase è‡ªå‹•ç”Ÿæˆ API

```swift
// SwiftUI ã‹ã‚‰ã® Supabase åˆ©ç”¨ä¾‹
class PostViewModel: ObservableObject {
    @Published var posts: [Post] = []
    private let supabase = SupabaseClient(...)

    func fetchNearbyPosts(lat: Double, lng: Double, radius: Int) async {
        do {
            let posts: [Post] = try await supabase
                .from("posts")
                .select()
                .within("location", lat: lat, lng: lng, radius: radius)
                .order("created_at", ascending: false)
                .execute()
                .value

            await MainActor.run {
                self.posts = posts
            }
        } catch {
            print("Error fetching posts: \(error)")
        }
    }
}
```

#### 2. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½

```swift
// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æŠ•ç¨¿ç›£è¦–
func subscribeToNearbyPosts() {
    supabase
        .from("posts")
        .on(.insert) { [weak self] payload in
            // æ–°ã—ã„æŠ•ç¨¿ã®å—ä¿¡å‡¦ç†
            self?.handleNewPost(payload.new)
        }
        .subscribe()
}
```

#### 3. Edge Functions ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- `/functions/v1/geocoding` - ä½æ‰€ â‡” åº§æ¨™å¤‰æ›
- `/functions/v1/emergency-alert` - ç·Šæ€¥é€šçŸ¥å‡¦ç†
- `/functions/v1/post-clustering` - æŠ•ç¨¿ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
- `/functions/v1/news-verification` - ãƒ‹ãƒ¥ãƒ¼ã‚¹çœŸå½æ€§ãƒã‚§ãƒƒã‚¯

---

## åœ°å›³ãƒ»ä½ç½®æƒ…å ±è¨­è¨ˆ

### åœ°å›³ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é¸æŠï¼ˆiOS MapKitï¼‰

#### 1. MapKit é¸æŠç†ç”±

- **ãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆ**: iOS ã‚·ã‚¹ãƒ†ãƒ ã¨ã®å®Œç’§ãªçµ±åˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: Metal ã«ã‚ˆã‚‹é«˜é€Ÿãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼**: Apple ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é‡è¦–è¨­è¨ˆ
- **ã‚³ã‚¹ãƒˆåŠ¹ç‡**: ç„¡æ–™ã§é«˜æ©Ÿèƒ½
- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ**: ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«ã®ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åœ°å›³

#### 2. è¿½åŠ åœ°å›³ã‚µãƒ¼ãƒ“ã‚¹é€£æº

```swift
// MapKit + Apple Services çµ±åˆ
struct MapView: UIViewRepresentable {
    func makeUIView(context: Context) -> MKMapView {
        let mapView = MKMapView()
        mapView.showsUserLocation = true
        mapView.userTrackingMode = .none
        mapView.mapType = .standard

        // iOS 17+ ã®æ–°æ©Ÿèƒ½æ´»ç”¨
        if #available(iOS 17.0, *) {
            mapView.preferredConfiguration = .standard(elevationStyle: .realistic)
        }

        return mapView
    }

    func updateUIView(_ mapView: MKMapView, context: Context) {
        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°å‡¦ç†
    }
}
```

#### 3. Apple Services é€£æº

- **Search**: MKLocalSearch ã«ã‚ˆã‚‹å ´æ‰€æ¤œç´¢
- **Directions**: MKDirections ã«ã‚ˆã‚‹é¿é›£çµŒè·¯æ¡ˆå†…
- **Look Around**: iOS ã®ã‚¹ãƒˆãƒªãƒ¼ãƒˆãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½

### ä½ç½®æƒ…å ±å‡¦ç†è¨­è¨ˆ

#### 1. ä½ç½®æƒ…å ±å–å¾—æ–¹å¼ (iOS CoreLocation)

```swift
struct LocationData {
    let latitude: Double
    let longitude: Double
    let accuracy: Double
    let timestamp: Date
    let source: LocationSource
}

enum LocationSource {
    case gps
    case network
    case manual
}

class LocationService: NSObject, ObservableObject {
    private let locationManager = CLLocationManager()
    @Published var currentLocation: LocationData?

    override init() {
        super.init()
        locationManager.delegate = self
        locationManager.desiredAccuracy = kCLLocationAccuracyBest
        locationManager.requestWhenInUseAuthorization()
    }

    func getCurrentLocation() {
        locationManager.requestLocation()
    }
}

extension LocationService: CLLocationManagerDelegate {
    func locationManager(_ manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) {
        guard let location = locations.last else { return }

        currentLocation = LocationData(
            latitude: location.coordinate.latitude,
            longitude: location.coordinate.longitude,
            accuracy: location.horizontalAccuracy,
            timestamp: location.timestamp,
            source: .gps
        )
    }
}
```

#### 2. ä½ç½®æƒ…å ±ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·

- **ç²¾åº¦èª¿æ•´**: ç”¨é€”ã«å¿œã˜ãŸä½ç½®ç²¾åº¦ã®èª¿æ•´ï¼ˆ100mã€œ1kmï¼‰
- **ä½ç½®æƒ…å ±ã®ãƒãƒƒã‚·ãƒ¥åŒ–**: æ­£ç¢ºãªä½ç½®ã®æš—å·åŒ–ä¿å­˜
- **åŒ¿ååŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³**: å¤§ã¾ã‹ãªã‚¨ãƒªã‚¢æƒ…å ±ã®ã¿ã®è¡¨ç¤ºé¸æŠ

### ã‚¸ã‚ªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½è¨­è¨ˆ

#### 1. é€†ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° (iOS CoreLocation)

```swift
struct AddressComponents {
    let country: String
    let prefecture: String
    let city: String
    let ward: String?
    let district: String?
    let street: String?
    let building: String?
}

class GeocodingService: ObservableObject {
    private let geocoder = CLGeocoder()

    func reverseGeocode(location: CLLocation) async throws -> AddressComponents {
        let placemarks = try await geocoder.reverseGeocodeLocation(location)

        guard let placemark = placemarks.first else {
            throw GeocodingError.noResults
        }

        return AddressComponents(
            country: placemark.country ?? "",
            prefecture: placemark.administrativeArea ?? "",
            city: placemark.locality ?? "",
            ward: placemark.subLocality,
            district: placemark.subThoroughfare,
            street: placemark.thoroughfare,
            building: placemark.name
        )
    }
}

enum GeocodingError: Error {
    case noResults
    case invalidLocation
}
```

#### 2. è¿‘éš£æ¤œç´¢æ©Ÿèƒ½

```sql
-- PostGIS ã‚’ä½¿ç”¨ã—ãŸè¿‘éš£æ¤œç´¢ã‚¯ã‚¨ãƒªä¾‹
SELECT
  id, title, content, created_at,
  ST_Distance(location, ST_Point($1, $2)::geography) as distance
FROM posts
WHERE
  ST_DWithin(location, ST_Point($1, $2)::geography, $3)
  AND created_at > NOW() - INTERVAL '24 hours'
ORDER BY distance ASC
LIMIT 50;
```

### åœ°å›³ä¸Šã§ã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºè¨­è¨ˆ

#### 1. ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°è¡¨ç¤º (MapKit)

```swift
struct ClusterConfig {
    let radius: Double
    let maxZoom: Double
    let minPoints: Int
}

class PostAnnotation: NSObject, MKAnnotation {
    let coordinate: CLLocationCoordinate2D
    let title: String?
    let subtitle: String?
    let post: Post

    init(post: Post) {
        self.post = post
        self.coordinate = CLLocationCoordinate2D(
            latitude: post.latitude,
            longitude: post.longitude
        )
        self.title = post.title
        self.subtitle = post.category.rawValue
        super.init()
    }
}

class PostClusterAnnotation: NSObject, MKAnnotation {
    let coordinate: CLLocationCoordinate2D
    let title: String?
    let subtitle: String?
    let posts: [Post]

    init(posts: [Post], coordinate: CLLocationCoordinate2D) {
        self.posts = posts
        self.coordinate = coordinate
        self.title = "\(posts.count)ä»¶ã®æŠ•ç¨¿"
        self.subtitle = "ã‚¿ãƒƒãƒ—ã—ã¦è©³ç´°ã‚’è¡¨ç¤º"
        super.init()
    }
}

class MapClusterService {
    func clusterPosts(_ posts: [Post], in region: MKCoordinateRegion) -> [MKAnnotation] {
        // MapKit ã®è‡ªå‹•ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ã‚’ä½¿ç”¨
        return posts.map { PostAnnotation(post: $0) }
    }
}
```

#### 2. å‹•çš„ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º

- **ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«é€£å‹•**: è©³ç´°åº¦ã«å¿œã˜ãŸãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
- **ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**: é¸æŠã‚«ãƒ†ã‚´ãƒªã®ã¿ã®è¡¨ç¤º
- **æ™‚é–“è»¸ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**: æŒ‡å®šæœŸé–“ã®æŠ•ç¨¿ã®ã¿è¡¨ç¤º
- **é‡è¦åº¦ã«ã‚ˆã‚‹å„ªå…ˆè¡¨ç¤º**: ç·Šæ€¥æƒ…å ±ã®å„ªå…ˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### èªè¨¼ãƒ»èªå¯è¨­è¨ˆ

#### 1. Supabase Auth èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

```swift
struct UserProfile {
    let id: UUID
    let email: String
    let role: UserRole
    let permissions: [String]
    let createdAt: Date
    let lastSignInAt: Date?
}

enum UserRole: String, CaseIterable {
    case user = "user"
    case moderator = "moderator"
    case admin = "admin"
}

class AuthService: ObservableObject {
    @Published var currentUser: UserProfile?
    @Published var isAuthenticated = false

    private let supabase = SupabaseClient(...)

    func signIn(email: String, password: String) async throws {
        let response = try await supabase.auth.signIn(
            email: email,
            password: password
        )

        await MainActor.run {
            self.currentUser = UserProfile(from: response.user)
            self.isAuthenticated = true
        }
    }

    func signOut() async throws {
        try await supabase.auth.signOut()

        await MainActor.run {
            self.currentUser = nil
            self.isAuthenticated = false
        }
    }

    func signInWithApple() async throws {
        // Apple Sign-in implementation with Supabase
    }
}
```

#### 2. èªå¯ãƒ¬ãƒ™ãƒ«è¨­è¨ˆ

- **Public**: ä¸€èˆ¬å…¬é–‹æƒ…å ±ï¼ˆåœ°å›³è¡¨ç¤ºã€å…¬é–‹æŠ•ç¨¿é–²è¦§ï¼‰
- **Authenticated**: èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆæŠ•ç¨¿ä½œæˆã€ã‚³ãƒ¡ãƒ³ãƒˆã€ã„ã„ã­ï¼‰
- **Owner**: ãƒªã‚½ãƒ¼ã‚¹æ‰€æœ‰è€…ï¼ˆæŠ•ç¨¿ç·¨é›†ãƒ»å‰Šé™¤ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ï¼‰
- **Moderator**: ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¶é™ï¼‰
- **Admin**: ç®¡ç†è€…ï¼ˆã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ã€å…¨æ¨©é™ï¼‰

### ãƒ‡ãƒ¼ã‚¿ä¿è­·è¨­è¨ˆ

#### 1. iOS æš—å·åŒ–æˆ¦ç•¥

```swift
// ä½ç½®æƒ…å ±ã®æš—å·åŒ– (iOS CryptoKit)
import CryptoKit

struct LocationEncryption {
    private static let key = SymmetricKey(size: .bits256)

    static func encrypt(latitude: Double, longitude: Double) throws -> Data {
        let locationData = LocationData(latitude: latitude, longitude: longitude)
        let jsonData = try JSONEncoder().encode(locationData)

        let sealedBox = try AES.GCM.seal(jsonData, using: key)
        return sealedBox.combined!
    }

    static func decrypt(encryptedData: Data) throws -> (latitude: Double, longitude: Double) {
        let sealedBox = try AES.GCM.SealedBox(combined: encryptedData)
        let decryptedData = try AES.GCM.open(sealedBox, using: key)

        let locationData = try JSONDecoder().decode(LocationData.self, from: decryptedData)
        return (locationData.latitude, locationData.longitude)
    }
}

private struct LocationData: Codable {
    let latitude: Double
    let longitude: Double
}
```

#### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æš—å·åŒ–

- **ä¿å­˜æ™‚æš—å·åŒ–**: PostgreSQL ã® TDEï¼ˆTransparent Data Encryptionï¼‰
- **ã‚«ãƒ©ãƒ ãƒ¬ãƒ™ãƒ«æš—å·åŒ–**: å€‹äººæƒ…å ±ãƒ»ä½ç½®æƒ…å ±ã®é¸æŠçš„æš—å·åŒ–
- **ã‚­ãƒ¼ç®¡ç†**: AWS KMS ã«ã‚ˆã‚‹æš—å·åŒ–ã‚­ãƒ¼ç®¡ç†

### ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¨­è¨ˆ

#### 1. ä½ç½®æƒ…å ±ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ (iOS)

```swift
struct PrivacySettings {
    let locationPrecision: LocationPrecision
    let shareLocation: Bool
    let emergencyOverride: Bool
}

enum LocationPrecision: String, CaseIterable {
    case exact = "exact"
    case approximate = "approximate"
    case areaOnly = "area_only"
}

class LocationPrivacyService {
    func applyPrivacyFilter(
        location: CLLocationCoordinate2D,
        settings: PrivacySettings
    ) -> CLLocationCoordinate2D {
        switch settings.locationPrecision {
        case .exact:
            return location
        case .approximate:
            return addNoise(to: location, radius: 100) // 100mä»¥å†…ã®ãƒã‚¤ã‚º
        case .areaOnly:
            return roundToArea(location: location, gridSize: 1000) // 1kmå››æ–¹ã«ä¸¸ã‚ã‚‹
        }
    }

    private func addNoise(to location: CLLocationCoordinate2D, radius: Double) -> CLLocationCoordinate2D {
        let randomAngle = Double.random(in: 0...(2 * .pi))
        let randomDistance = Double.random(in: 0...radius)

        let deltaLat = randomDistance * cos(randomAngle) / 111000
        let deltaLng = randomDistance * sin(randomAngle) / (111000 * cos(location.latitude * .pi / 180))

        return CLLocationCoordinate2D(
            latitude: location.latitude + deltaLat,
            longitude: location.longitude + deltaLng
        )
    }

    private func roundToArea(location: CLLocationCoordinate2D, gridSize: Double) -> CLLocationCoordinate2D {
        let gridSizeDegrees = gridSize / 111000 // ç´„1åº¦ = 111km

        let roundedLat = round(location.latitude / gridSizeDegrees) * gridSizeDegrees
        let roundedLng = round(location.longitude / gridSizeDegrees) * gridSizeDegrees

        return CLLocationCoordinate2D(latitude: roundedLat, longitude: roundedLng)
    }
}
```

#### 2. ãƒ‡ãƒ¼ã‚¿åŒ¿ååŒ–

- **å€‹äººè­˜åˆ¥å­ã®é™¤å»**: è‡ªå‹•çš„ãª PII ãƒ‡ãƒ¼ã‚¿ã®æ¤œå‡ºãƒ»ãƒã‚¹ã‚­ãƒ³ã‚°
- **çµ±è¨ˆçš„é–‹ç¤ºåˆ¶å¾¡**: k-åŒ¿åæ€§ã®ç¢ºä¿
- **å·®åˆ†ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼**: çµ±è¨ˆãƒ‡ãƒ¼ã‚¿æä¾›æ™‚ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·

### ç½å®³æ™‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®

#### 1. ç·Šæ€¥æ™‚ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ (iOS)

```swift
enum DisasterLevel: String, CaseIterable {
    case low = "low"
    case medium = "medium"
    case high = "high"
}

class EmergencySecurityService: ObservableObject {
    @Published var currentDisasterLevel: DisasterLevel = .low
    @Published var isEmergencyMode = false

    private let supabase = SupabaseClient(...)

    func activateEmergencyMode(disasterLevel: DisasterLevel) async {
        await MainActor.run {
            self.currentDisasterLevel = disasterLevel
            self.isEmergencyMode = true
        }

        switch disasterLevel {
        case .high:
            // å…¬å¼æ©Ÿé–¢ã®ã¿æŠ•ç¨¿å¯èƒ½
            await restrictPostingToOfficial()
            // ä½ç½®æƒ…å ±ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¨­å®šã‚’ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰ã«å¤‰æ›´
            await overrideLocationPrivacy()
        case .medium:
            // æ¤œè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿æŠ•ç¨¿å¯èƒ½
            await restrictPostingToVerified()
        case .low:
            // é€šå¸¸ã®æŠ•ç¨¿åˆ¶é™
            await applyStandardRestrictions()
        }
    }

    private func restrictPostingToOfficial() async {
        // Supabase RLS policies ã‚’é€šã˜ã¦åˆ¶é™å®Ÿè£…
    }

    private func overrideLocationPrivacy() async {
        // ç·Šæ€¥æ™‚ã®ä½ç½®æƒ…å ±å…±æœ‰è¨­å®š
    }

    private func restrictPostingToVerified() async {
        // æ¤œè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã®æŠ•ç¨¿åˆ¶é™
    }

    private func applyStandardRestrictions() async {
        // é€šå¸¸ã®æŠ•ç¨¿åˆ¶é™
    }
}
```

#### 2. æƒ…å ±ä¿¡é ¼æ€§ç¢ºä¿

- **å…¬å¼æ©Ÿé–¢èªè¨¼**: æ”¿åºœãƒ»è‡ªæ²»ä½“ãƒ»å ±é“æ©Ÿé–¢ã®ç‰¹åˆ¥èªè¨¼
- **ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯é€£æº**: å¤–éƒ¨ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯æ©Ÿé–¢ã¨ã® API é€£æº
- **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ¤œè¨¼**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æƒ…å ±æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ 

---

## ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

#### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
-- users ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  username VARCHAR(50) UNIQUE NOT NULL,
  display_name VARCHAR(100),
  bio TEXT,
  avatar_url VARCHAR(500),
  cover_url VARCHAR(500),
  location_precision location_precision_enum DEFAULT 'approximate',
  is_verified BOOLEAN DEFAULT FALSE,
  is_official BOOLEAN DEFAULT FALSE,
  role user_role_enum DEFAULT 'user',
  privacy_settings JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  last_active_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- user_follows ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ•ã‚©ãƒ­ãƒ¼é–¢ä¿‚ï¼‰
CREATE TABLE user_follows (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  follower_id UUID REFERENCES users(id) ON DELETE CASCADE,
  following_id UUID REFERENCES users(id) ON DELETE CASCADE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(follower_id, following_id)
);
```

#### 2. æŠ•ç¨¿é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
-- posts ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE posts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  url VARCHAR(2000),
  url_metadata JSONB,
  location GEOGRAPHY(POINT, 4326),
  location_encrypted TEXT,
  address JSONB,
  category post_category_enum NOT NULL,
  visibility post_visibility_enum DEFAULT 'public',
  is_emergency BOOLEAN DEFAULT FALSE,
  emergency_level emergency_level_enum,
  trust_score DECIMAL(3,2) DEFAULT 0.5,
  like_count INTEGER DEFAULT 0,
  comment_count INTEGER DEFAULT 0,
  share_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ç©ºé–“ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_posts_location ON posts USING GIST (location);
CREATE INDEX idx_posts_category_created ON posts (category, created_at DESC);
CREATE INDEX idx_posts_emergency_created ON posts (is_emergency, created_at DESC) WHERE is_emergency = TRUE;

-- post_media ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
CREATE TABLE post_media (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID REFERENCES posts(id) ON DELETE CASCADE,
  media_type media_type_enum NOT NULL,
  file_url VARCHAR(500) NOT NULL,
  thumbnail_url VARCHAR(500),
  file_size INTEGER,
  width INTEGER,
  height INTEGER,
  duration INTEGER, -- å‹•ç”»ã®å ´åˆ
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### 3. ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
-- post_likes ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE post_likes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID REFERENCES posts(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  reaction_type reaction_type_enum DEFAULT 'like',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(post_id, user_id)
);

-- post_comments ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE post_comments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID REFERENCES posts(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  parent_comment_id UUID REFERENCES post_comments(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  like_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- notifications ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  type notification_type_enum NOT NULL,
  title VARCHAR(200) NOT NULL,
  message TEXT NOT NULL,
  data JSONB,
  is_read BOOLEAN DEFAULT FALSE,
  is_push_sent BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### 4. ç·Šæ€¥æ™‚ãƒ»ç½å®³é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
-- emergency_events ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE emergency_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  event_type emergency_event_type_enum NOT NULL,
  title VARCHAR(200) NOT NULL,
  description TEXT NOT NULL,
  severity emergency_severity_enum NOT NULL,
  affected_area GEOGRAPHY(POLYGON, 4326),
  status emergency_status_enum DEFAULT 'active',
  official_source VARCHAR(200),
  external_id VARCHAR(100),
  started_at TIMESTAMP WITH TIME ZONE NOT NULL,
  ended_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- shelters ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆé¿é›£æ‰€æƒ…å ±ï¼‰
CREATE TABLE shelters (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(200) NOT NULL,
  address VARCHAR(500) NOT NULL,
  location GEOGRAPHY(POINT, 4326) NOT NULL,
  capacity INTEGER,
  current_occupancy INTEGER DEFAULT 0,
  facilities JSONB,
  contact_phone VARCHAR(20),
  status shelter_status_enum DEFAULT 'open',
  managed_by VARCHAR(200),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ

#### 1. Enum å‹å®šç¾©

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£
CREATE TYPE user_role_enum AS ENUM ('user', 'moderator', 'admin');
CREATE TYPE location_precision_enum AS ENUM ('exact', 'approximate', 'area_only');

-- æŠ•ç¨¿é–¢é€£
CREATE TYPE post_category_enum AS ENUM (
  'news', 'traffic', 'weather', 'crime', 'emergency',
  'community', 'business', 'sports', 'entertainment', 'other'
);
CREATE TYPE post_visibility_enum AS ENUM ('public', 'followers', 'area', 'private');
CREATE TYPE media_type_enum AS ENUM ('image', 'video', 'audio', 'document');
CREATE TYPE reaction_type_enum AS ENUM ('like', 'love', 'laugh', 'angry', 'sad');

-- ç·Šæ€¥æ™‚é–¢é€£
CREATE TYPE emergency_event_type_enum AS ENUM (
  'earthquake', 'tsunami', 'flood', 'fire', 'typhoon',
  'landslide', 'volcanic', 'accident', 'security', 'other'
);
CREATE TYPE emergency_severity_enum AS ENUM ('info', 'warning', 'critical');
CREATE TYPE emergency_level_enum AS ENUM ('low', 'medium', 'high');
CREATE TYPE emergency_status_enum AS ENUM ('active', 'resolved', 'monitoring');
CREATE TYPE shelter_status_enum AS ENUM ('open', 'full', 'closed', 'unknown');

-- é€šçŸ¥é–¢é€£
CREATE TYPE notification_type_enum AS ENUM (
  'post_like', 'post_comment', 'follow', 'mention',
  'emergency_alert', 'system_notice'
);
```

#### 2. JSONB ãƒ‡ãƒ¼ã‚¿æ§‹é€ ä¾‹

```typescript
// privacy_settings ã®æ§‹é€ 
interface PrivacySettings {
  locationSharing: boolean;
  locationPrecision: 'exact' | 'approximate' | 'area_only';
  profileVisibility: 'public' | 'followers' | 'private';
  emergencyOverride: boolean;
  dataRetention: {
    deleteAfterDays?: number;
    autoArchive: boolean;
  };
}

// url_metadata ã®æ§‹é€ 
interface URLMetadata {
  title?: string;
  description?: string;
  image?: string;
  siteName?: string;
  publishedAt?: string;
  author?: string;
  extractedLocation?: {
    coordinates?: [number, number];
    address?: string;
    confidence: number;
  };
}

// address ã®æ§‹é€ 
interface AddressComponents {
  country: string;
  countryCode: string;
  prefecture: string;
  prefectureCode: string;
  city: string;
  ward?: string;
  district?: string;
  street?: string;
  building?: string;
  postalCode?: string;
}

// shelter facilities ã®æ§‹é€ 
interface ShelterFacilities {
  hasWater: boolean;
  hasElectricity: boolean;
  hasInternet: boolean;
  hasFood: boolean;
  hasMedical: boolean;
  hasPets: boolean;
  wheelchairAccessible: boolean;
  languages: string[];
}
```

### ä½ç½®æƒ…å ±ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

#### 1. PostGIS ç©ºé–“ãƒ‡ãƒ¼ã‚¿å‹

```sql
-- åœ°ç†åº§æ¨™ç³»ï¼ˆWGS84ï¼‰ã‚’ä½¿ç”¨
-- GEOGRAPHY å‹ã¯åœ°çƒã®æ›²ç‡ã‚’è€ƒæ…®ã—ãŸè¨ˆç®—ãŒå¯èƒ½

-- ãƒã‚¤ãƒ³ãƒˆï¼ˆæŠ•ç¨¿ä½ç½®ï¼‰
ALTER TABLE posts ADD COLUMN location GEOGRAPHY(POINT, 4326);

-- ãƒãƒªã‚´ãƒ³ï¼ˆç½å®³å½±éŸ¿ã‚¨ãƒªã‚¢ï¼‰
ALTER TABLE emergency_events ADD COLUMN affected_area GEOGRAPHY(POLYGON, 4326);

-- ç©ºé–“ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½œæˆ
CREATE INDEX idx_posts_location_gist ON posts USING GIST (location);
CREATE INDEX idx_emergency_area_gist ON emergency_events USING GIST (affected_area);
```

#### 2. ç©ºé–“ã‚¯ã‚¨ãƒªã®ä¾‹

```sql
-- æŒ‡å®šç¯„å›²å†…ã®æŠ•ç¨¿ã‚’å–å¾—
SELECT p.*, u.username
FROM posts p
JOIN users u ON p.user_id = u.id
WHERE ST_DWithin(
  p.location,
  ST_Point(139.6917, 35.6895)::geography, -- æ±äº¬é§…ã®åº§æ¨™
  1000 -- 1km ä»¥å†…
)
ORDER BY p.created_at DESC;

-- ç½å®³å½±éŸ¿ã‚¨ãƒªã‚¢å†…ã®æŠ•ç¨¿ã‚’å–å¾—
SELECT p.*
FROM posts p, emergency_events e
WHERE ST_Within(p.location, e.affected_area)
  AND e.status = 'active'
  AND e.severity IN ('warning', 'critical');
```

#### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```sql
-- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åˆ†å‰²ï¼ˆæœˆåˆ¥ï¼‰
CREATE TABLE posts_2025_01 PARTITION OF posts
FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');

-- éƒ¨åˆ†ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆç·Šæ€¥æŠ•ç¨¿ã®ã¿ï¼‰
CREATE INDEX idx_posts_emergency_location
ON posts USING GIST (location)
WHERE is_emergency = TRUE;

-- è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_posts_category_location_created
ON posts (category, created_at DESC)
INCLUDE (location)
WHERE visibility = 'public';
```

---

**æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**æœ€çµ‚æ›´æ–°æ—¥**: 2025-10-09  
**æ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æ‰¿èªå¾…ã¡
